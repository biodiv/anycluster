{"mappings":"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","sources":["src/anycluster-leaflet.ts"],"sourcesContent":["import {\n    AnyclusterClient,\n    AnyclusterClientSettings,\n    Viewport,\n    Cluster,\n    ClusterMethod,\n    GeoJSON as IGeoJSON,\n} from 'anycluster-client';\n\nimport * as  L from 'leaflet';\n\nexport {\n    ClusterMethod\n};\n\nexport class AnyclusterLeaflet extends AnyclusterClient {\n\n    currentZoom: number\n\n    constructor(map: any, apiUrl: string, markerFolderPath: string, settings: AnyclusterClientSettings) {\n        super(map, apiUrl, markerFolderPath, settings);\n\n        this.currentZoom = this.getZoom();\n\n    }\n\n\n    removeArea() {\n        if (this.map.hasOwnProperty(\"areaLayer\")) {\n            this.map.areaLayer.clearLayers();\n        }\n    }\n\n    addArea(geojson: IGeoJSON) {\n        if (!this.map.hasOwnProperty(\"areaLayer\")) {\n            this.createAreaLayer();\n        }\n\n        L.geoJSON(geojson, {\n            style: {\n                color: 'red'\n            }\n        }).addTo(this.map.areaLayer);\n\n    }\n\n    createClusterLayers() {\n        const kmeansLayer = L.layerGroup().addTo(this.map);\n        this.map.kmeansLayer = kmeansLayer;\n\n        // support geojson for grid cluster\n        const gridClusterLayer = L.layerGroup().addTo(this.map);\n        this.map.gridClusterLayer = gridClusterLayer;\n\n    }\n\n    createAreaLayer() {\n        const areaLayer = L.layerGroup().addTo(this.map);\n        this.map.areaLayer = areaLayer;\n\n    }\n\n    getMarkerIcon(cluster: Cluster) {\n\n        // get the correct icon\n        const piniconObj = this.selectPinIcon(cluster);\n\n        // create a leaflet icon\n        const markerIcon = L.icon({\n            iconUrl: piniconObj.url,\n            iconSize: piniconObj.size,\n            iconAnchor: piniconObj.anchor,\n            popupAnchor: piniconObj.popupAnchor\n        });\n\n        return markerIcon;\n\n    }\n\n    drawMarker(cluster: Cluster) {\n        const markerIcon = this.getMarkerIcon(cluster);\n\n        const latLng = L.latLng(cluster.center.y, cluster.center.x);\n\n        const marker_options = {\n            icon: markerIcon\n        };\n\n        let marker = L.marker(latLng, marker_options);\n\n        marker = this.setMarkerProps(marker, cluster);\n\n        this.addMarkerClickListener(marker);\n\n        marker.addTo(this.map.kmeansLayer);\n\n        this.markerList.push(marker);\n\n    }\n\n    drawCell(cluster: Cluster) {\n        const count = cluster.count;\n\n        if (count == 1) {\n            this.drawMarker(cluster)\n        }\n        else {\n            const latLng = L.latLng(cluster.center.y, cluster.center.x);\n\n            const geojson = {\n                \"type\": \"Feature\",\n                \"count\": count,\n                \"geometry\": cluster.geojson,\n                \"properties\": {\n                    \"count\": count\n                }\n            };\n\n\n            const roundedCount = this.roundMarkerCount(count);\n\n            const fillColor = this.gridFillColors[roundedCount];\n            const strokeColor = this.gridStrokeColors[roundedCount];\n            const strokeWeight = 1;\n\n            const cell = L.geoJSON(geojson, {\n                style: {\n                    color: strokeColor,\n                    stroke: true,\n                    fillColor: fillColor,\n                    weight: strokeWeight,\n                    fillOpacity: 1,\n                }\n            });\n\n            // add properties required by anycluster to marker\n            cell.latitude = latLng.lat;\n            cell.longitude = latLng.lng;\n            cell.x = latLng.lng;\n            cell.y = latLng.lat;\n            cell.count = count;\n            cell.geojson = geojson;\n\n            this.addMarkerClickListener(cell);\n\n            cell.addTo(this.map.gridClusterLayer);\n        }\n\n    }\n\n    removeAllMarkers() {\n\n        // remove all the markers in one go\n        this.map.kmeansLayer.clearLayers();\n\n        if (this.map.hasOwnProperty(\"gridClusterLayer\")) {\n            this.map.gridClusterLayer.clearLayers();\n        }\n\n        this.markerList.length = 0;\n\n\n    }\n\n    addMapEventListeners() {\n        this.map.addEventListener(\"moveend\", event => this.getClusters());\n        this.map.addEventListener(\"zoomend\", event => this.removeAllMarkers());\n    }\n\n\n    getViewport(): Viewport {\n\n        const viewport = this.map.getBounds();\n\n        if (viewport.isValid()) {\n            const viewportJSON = {\n                \"left\": viewport.getSouthWest().wrap().lng,\n                \"top\": viewport.getNorthEast().wrap().lat,\n                \"right\": viewport.getNorthEast().wrap().lng,\n                \"bottom\": viewport.getSouthWest().wrap().lat\n            };\n\n            return viewportJSON;\n        }\n        else {\n            throw new Error(\"invalid viewport\");\n        }\n\n    }\n\n    getZoom(): number {\n        return this.map.getZoom();\n    }\n\n    setZoom(zoom: number): void {\n        this.map.setZoom(zoom);\n    }\n\n\n    setMap(x: number, y: number, zoom: number): void {\n        const center = L.latLng(y, x);\n        this.map.setView(center, zoom);\n    }\n\n    addMarkerClickListener(marker) {\n\n        const zoom = this.getZoom();\n\n        if (zoom >= 13 || marker.count == 1) {\n            marker.on(\"click\", (event) => {\n                this.onMarkerFinalClick(marker);\n            });\n        }\n\n        else {\n            marker.on(\"click\", (event) => {\n                this.markerClickFunction(marker.x, marker.y);\n            });\n        }\n    }\n\n}"],"names":["$daa68199c6ecee0a$export$d28c3646e727c4c9","$kEX8F$anyclusterclient","AnyclusterClient","constructor","map","apiUrl","markerFolderPath","settings","super","this","currentZoom","getZoom","removeArea","hasOwnProperty","areaLayer","clearLayers","addArea","geojson","createAreaLayer","$kEX8F$leaflet","geoJSON","style","color","addTo","createClusterLayers","kmeansLayer","layerGroup","gridClusterLayer","getMarkerIcon","cluster","piniconObj","selectPinIcon","icon","iconUrl","url","iconSize","size","iconAnchor","anchor","popupAnchor","drawMarker","markerIcon","latLng","center","y","x","marker_options","marker","setMarkerProps","addMarkerClickListener","markerList","push","drawCell","count","type","geometry","properties","roundedCount","roundMarkerCount","fillColor","gridFillColors","strokeColor","gridStrokeColors","strokeWeight","cell","stroke","weight","fillOpacity","latitude","lat","longitude","lng","removeAllMarkers","length","addMapEventListeners","addEventListener","event","getClusters","getViewport","viewport","getBounds","isValid","left","getSouthWest","wrap","top","getNorthEast","right","bottom","Error","setZoom","zoom","setMap","setView","on","onMarkerFinalClick","markerClickFunction"],"version":3,"file":"main.js.map"}
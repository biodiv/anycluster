{"mappings":"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","sources":["src/index.ts","src/anycluster-google.ts"],"sourcesContent":["export {\n    ClusterMethod,\n    AnyclusterGoogle,\n} from \"./anycluster-google\";","import {\n    AnyclusterClient,\n    AnyclusterClientSettings,\n    Viewport,\n    Cluster,\n    ClusterMethod,\n    GeoJSON as IGeoJSON,\n} from 'anycluster-client';\n\nimport { Loader } from '@googlemaps/js-api-loader';\n\nexport {\n    ClusterMethod\n};\n\nexport class AnyclusterGoogle extends AnyclusterClient {\n\n    currentZoom: number\n\n    google: any\n\n    constructor(apiKey: string, map: any, apiUrl: string, markerFolderPath: string, settings: AnyclusterClientSettings) {\n\n        const loader = new Loader({\n            apiKey: apiKey,\n            version: \"monthly\",\n            libraries: [\"marker\", \"drawing\"]\n        });\n\n        loader.load().then((google) => {\n            this.google = google;\n        })\n            .catch(e => {\n                // do something\n            });\n\n        super(map, apiUrl, markerFolderPath, settings);\n\n        this.currentZoom = this.getZoom();\n\n    }\n\n\n    removeArea() {\n        this.map.data.forEach((feature) => {\n            this.map.data.remove(feature);\n        });\n    }\n\n    addArea(geojson: IGeoJSON) {\n\n        this.map.data.addGeoJson(\n            geojson\n        );\n\n    }\n\n    createClusterLayers() {\n\n        this.map.data.setStyle((feature) => {\n\n            if (feature.getProperty(\"clustertype\") == \"cell\"){\n\n                const roundedCount = this.roundMarkerCount(feature.getProperty(\"count\"));\n\n                const fillColor = this.gridStrokeColors[roundedCount];\n                const strokeColor = this.gridStrokeColors[roundedCount];\n                const strokeWeight = 1;\n\n                const style = {\n                    \"fillColor\": fillColor,\n                    //\"fillOpacity\": .5,\n                    \"strokeWeight\": strokeWeight,\n                    \"strokeColor\": strokeColor,\n                    //\"strokeOpacity\": .8\n                };\n\n                return style;\n            }\n\n        });\n\n        this.map.data.addListener(\"click\", (event: any) => {\n            const feature = event.feature;\n\n            if (feature.clustertype == \"cell\" || feature.clustertype == \"marker\"){\n\n                let zoom = this.getZoom();\n\n                if (zoom >= 13 || feature.count == 1) {\n                    this.onMarkerFinalClick(feature);\n                }\n\n                else {\n                    this.markerClickFunction(feature.x, feature.y);\n                }\n            }\n        });\n    }\n\n    createAreaLayer() {\n    }\n\n    getMarkerIcon(cluster: Cluster) {\n        // get the correct icon\n        const piniconObj = this.selectPinIcon(cluster);\n\n        const iconSize = new this.google.maps.Size(piniconObj.size[0], piniconObj.size[1]);\n        const anchor = new this.google.maps.Point(piniconObj.anchor[0], piniconObj.anchor[1]);\n\n        const markerIcon = {\n            \"url\": piniconObj.url,\n            \"size\": iconSize,\n            \"anchor\": anchor,\n        };\n\n        return markerIcon;\n    }\n\n    drawMarker(cluster: Cluster) {\n\n        const markerIcon = this.getMarkerIcon(cluster);\n\n        const markerOptions = {\n            \"map\": this.map,\n            \"position\": {\n                \"lat\": cluster.center.y,\n                \"lng\": cluster.center.x\n            },\n            \"icon\": markerIcon,\n        };\n\n        let marker = new this.google.maps.Marker(markerOptions);\n\n        marker = this.setMarkerProps(marker, cluster);\n\n        this.addMarkerClickListener(marker);\n\n        this.markerList.push(marker);\n    }\n\n    drawCell(cluster: Cluster) {\n        const count = cluster.count;\n\n        if (count == 1) {\n            this.drawMarker(cluster);\n        }\n\n        else {\n\n            const geojson = {\n                \"type\": \"Feature\",\n                \"geometry\": cluster.geojson,\n                \"properties\": {\n                    \"clustertype\" : \"cell\",\n                    \"x\": cluster.center.x,\n                    \"y\": cluster.center.y,\n                    \"count\": count,\n                    \"geojson\": cluster.geojson,\n                }\n            };\n\n            const cell = this.map.data.addGeoJson(geojson)[0];\n\n            cell.x = cluster.center.x;\n            cell.y = cluster.center.y;\n            cell.count = count;\n            cell.geojson = geojson;\n            cell.clustertype = \"cell\";\n\n        }\n    }\n\n    removeAllMarkers() {\n\n        for (let i = 0; i < this.markerList.length; i++) {\n            this.markerList[i].setMap(null);\n        }\n\n        this.map.data.forEach((feature) => {\n            if (feature.clustertype == \"cell\"){\n                this.map.data.remove(feature);\n            }\n        });\n\n        this.markerList.length = 0;\n    }\n\n    addMapEventListeners() {\n        this.map.addListener(\"dragend\", () => this.getClusters());\n        this.map.addListener(\"zoom_changed\", () => {\n            this.removeAllMarkers();\n            this.getClusters();\n        });\n    }\n\n\n    getViewport(): Viewport {\n\n        const latLngBounds = this.map.getBounds();\n        const northEast = latLngBounds.getNorthEast();\n        const southWest = latLngBounds.getSouthWest();\n\n        const viewport = {\n            \"left\": southWest.lng(),\n            \"right\": northEast.lng(),\n            \"top\": northEast.lat(),\n            \"bottom\": southWest.lat(),\n        };\n\n        return viewport;\n    }\n\n    getZoom(): number {\n        return this.map.getZoom();\n    }\n\n    setZoom(zoom: number): void {\n        this.map.setZoom(zoom);\n    }\n\n\n    setMap(x: number, y: number, zoom: number): void {\n\n        const mapOptions = {\n            \"center\": {\n                lat: y,\n                lng: x\n            },\n            \"zoom\": zoom,\n        };\n\n        this.map.setOptions(mapOptions);\n    }\n\n    addMarkerClickListener(marker) {\n\n        const zoom = this.getZoom();\n\n        if (zoom >= 13 || marker.count == 1) {\n            marker.addListener(\"click\", (event) => {\n                this.onMarkerFinalClick(marker);\n            });\n        }\n\n        else {\n            marker.addListener(\"click\", (event) => {\n                this.markerClickFunction(marker.x, marker.y);\n            });\n        }\n    }\n\n}"],"names":[],"version":3,"file":"ancluster-google.js.map"}